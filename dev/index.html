<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Design Document · HallPIC</title><meta name="title" content="Design Document · HallPIC"/><meta property="og:title" content="Design Document · HallPIC"/><meta property="twitter:title" content="Design Document · HallPIC"/><meta name="description" content="Documentation for HallPIC."/><meta property="og:description" content="Documentation for HallPIC."/><meta property="twitter:description" content="Documentation for HallPIC."/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href>HallPIC</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Design Document</a><ul class="internal"><li><a class="tocitem" href="#Modular-design"><span>Modular design</span></a></li><li><a class="tocitem" href="#Temporal-order-of-accuracy-and-operator-splitting"><span>Temporal order of accuracy and operator splitting</span></a></li><li><a class="tocitem" href="#Strong-emphasis-on-verification-and-testing"><span>Strong emphasis on verification and testing</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Design Document</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Design Document</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/UM-PEPL/HallPIC" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/UM-PEPL/HallPIC/blob/main/docs/src/index.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Design-Document"><a class="docs-heading-anchor" href="#Design-Document">Design Document</a><a id="Design-Document-1"></a><a class="docs-heading-anchor-permalink" href="#Design-Document" title="Permalink"></a></h1><p>Here are some unordered thoughts for the design of this PIC module for HallThruster.jl</p><h2 id="Modular-design"><a class="docs-heading-anchor" href="#Modular-design">Modular design</a><a id="Modular-design-1"></a><a class="docs-heading-anchor-permalink" href="#Modular-design" title="Permalink"></a></h2><p>We should strive to make the code as modular as possible, with only the minimum possible information shared between modules. Preliminarily, the modules that jump out to me are </p><ul><li>Heavy species</li><li>Electron energy</li><li>Ohm&#39;s law</li></ul><p>The electron energy and Ohm&#39;s law modules should know nothing about the implementation of the heavy species module (i.e. whether it is fluid or PIC). The same should go in reverse. The heavy species module should provide the following information to the other parts of the code:</p><ul><li>Species densities/velocities/temperatures</li><li>Ionization/excitation energy losses</li></ul><p>If these are sufficiently distinct, the heavy species module could be split further into one which advances particles/handles BCs, and one which performs reaction calculations.</p><p>We should take care to define the public APIs of each modules in such a way that implementation details are hidden as much as possible. This was a major mistake in HallThruster.jl, which exposed the internal details of the code to the user in a way that made refactoring without changing the user interface very challenging.</p><h2 id="Temporal-order-of-accuracy-and-operator-splitting"><a class="docs-heading-anchor" href="#Temporal-order-of-accuracy-and-operator-splitting">Temporal order of accuracy and operator splitting</a><a id="Temporal-order-of-accuracy-and-operator-splitting-1"></a><a class="docs-heading-anchor-permalink" href="#Temporal-order-of-accuracy-and-operator-splitting" title="Permalink"></a></h2><p>HallThruster.jl does not at present use a principled operator splitting scheme for updating its various subcomponents. This caps us to 1st order temporal accuracy and may be less than ideal from a stability standpoint. Using the highly modular design approach outlined above, we can instead adopt a more rigorous splitting strategy (likely <a href="https://en.wikipedia.org/wiki/Strang_splitting"><em>Strang splitting</em></a>) to perform the update at each timestep. This lets each module take care of its own timestepping in the way that makes then most sense for the numerics of that module, and gives us the possibility of second-order temporal accuracy. This will prove valuable for cases in which the transient behavior of the thruster is important.</p><h2 id="Strong-emphasis-on-verification-and-testing"><a class="docs-heading-anchor" href="#Strong-emphasis-on-verification-and-testing">Strong emphasis on verification and testing</a><a id="Strong-emphasis-on-verification-and-testing-1"></a><a class="docs-heading-anchor-permalink" href="#Strong-emphasis-on-verification-and-testing" title="Permalink"></a></h2><p>Types of test</p><ul><li><strong>Unit tests</strong>: These are tests of individual functions or &quot;units&quot; in the code.   They are the easiest kind of test to write, and are essential for making sure the nuts and bolts of the code work as anticipated.   As they grow to test larger chunks of the code, however, they can become brittle and flaky as more and more test setup is needed to &quot;mock&quot; parts of the code not directly under testing.</li><li><strong>Property tests</strong>: These check to make sure specific properties hold.   When done well, these can automatically search an input space to try and find cases that violate the properties we have set.   Whenenver possible, we should try and identify properties that either 1) always hold or 2) hold under some known set of conditions and test for these automatically.   Some easy ones include mass conservation and one of momentum/energy conservation, depending on the PIC scheme we pic.   Should also check current conservation.   Smaller invariants are also worth checking, like verifying that the output of some function is always of a specific form or in a specific range</li><li><strong>Order verification tests</strong>: These use artificial source terms and the method of manufactured solutions to check that a given discretized PDE is being solved to the desired order of accuracy.   We use these in HallThruster.jl for the ion fluid model and the electron energy equation, but we could also do this for other parts of the code, like gradient computations.   We should try to implement these in a way that requires as little mocking as possible, as the setup code for these tests needs to maintain and can become burdensome.</li><li><strong>Regression tests</strong>: These check that the observable behavior of the code has not changed unexpectedly.   There are three main types of regression test, each with their own challenges and uses.<ol><li><em>Behavior regression</em>: This checks that the code has not changed its overall behavior.  For us, this means the predicted thruster performance and plasma properties.  These tests are easy to implement, but rely on you knowing exactly what observable behavior you care about, and what exactly constitutes a change.</li><li><em>Performance regression</em>: This type of test checks that we haven&#39;t made the code slower.  This is quite challenging, as the performance of the code varies from machine to machine so we cannot easily specify a standard of performance that we can check against.  I have not yet figured out a good way to do these sorts of tests.</li><li><em>Bug regression</em>: This sort of test verifies that a bug stays fixed.  When we fix a bug, a test that would have triggered the bug should be added to the code, so that we can check for all time afterward that the bug stays squashed</li></ol></li></ul><h3 id="Axisymmetry-and-quasi-1D-flow"><a class="docs-heading-anchor" href="#Axisymmetry-and-quasi-1D-flow">Axisymmetry and quasi-1D flow</a><a id="Axisymmetry-and-quasi-1D-flow-1"></a><a class="docs-heading-anchor-permalink" href="#Axisymmetry-and-quasi-1D-flow" title="Permalink"></a></h3><p>It would be nice if particles could move in 2D so that we can more self-consistently model wall losses. This could move the code in a quasi-2D direction, given some assumptions. Axisymmetry complicates the PIC update significantly, however, so this needs to be done carefully.</p></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.9.0 on <span class="colophon-date" title="Tuesday 18 March 2025 18:49">Tuesday 18 March 2025</span>. Using Julia version 1.11.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
